<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Technical details • CADET</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Technical details">
<meta property="og:description" content="CADET">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CADET</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/technical_details.html">Technical details</a>
</li>
<li>
  <a href="../articles/Tutorials.html">Tutorials for K-means clustering</a>
</li>
<li>
  <a href="../articles/Tutorials_hier.html">Tutorials for hierarchical clustering</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Technical details</h1>
            
      
      
      <div class="hidden name"><code>technical_details.Rmd</code></div>

    </div>

    
    
<center>
<img src="../reference/figures/fig_1.png" style="width:90.0%"><figcaption>
Figure 1: We simulated one dataset according to <span class="math inline">\({MN}_{100\times 10}(\mu, \textbf{I}_{100},
\Sigma)\)</span>, where <span class="math inline">\(\mu_i =
(1,0_9)^T\)</span> for <span class="math inline">\(i=1,\ldots,
50\)</span> and <span class="math inline">\(\mu_i = (0_9,1)^T\)</span>
for <span class="math inline">\(i=51,\ldots, 100\)</span>, and <span class="math inline">\(\Sigma_{ij} = 1\{i=j\}+0.4\cdot 1\{i\neq
j\}\)</span>. <em>(a)</em>: Empirical distribution of feature 2 based on
the simulated data set. In this case, all observations have the same
mean for feature 2. <em>(b)</em>: We apply k-means clustering to obtain
two clusters and plot the empirical distribution of feature 2 stratified
by the clusters. <em>(c)</em>: Quantile-quantile plot of naive z-test
(black) our proposed p-values (orange) applied to the simulated data
sets for testing the null hypotheses for a difference in means for
features 2–8.
</figcaption>
</center>
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>This package, as well as its underlying methodology, is motivated by
the practical need to interpret and validate groups of observations
obtained via clustering. In this case, a common validation approach
involves testing differences in feature means between observations in
two estimated clusters. However, classical hypothesis tests lead to an
inflated Type I error rate, because the p-values are computed using the
same set of data used for generating the hypothesis.</p>
<p>To overcome this problem, we propose a new test for the difference in
means in a single feature between a pair of clusters obtained using
hierarchical or k-means clustering. More details can be found in our
manuscript (Chen and Gao, 2023+).</p>
<p>In this tutorial, we provide an overview of our selective inference
approach. Details for the computationally-efficient implementation of
our proposed p-value can be found in Sections 3 and 4 of our manuscript,
available at arXiv_link_here.</p>
</div>
<div class="section level3">
<h3 id="model-setup">Model setup<a class="anchor" aria-label="anchor" href="#model-setup"></a>
</h3>
<p>Let <span class="math inline">\(x \in \mathbb{R}^{n \times
q}\)</span> be a data matrix with <span class="math inline">\(n\)</span>
observations of <span class="math inline">\(q\)</span> features that we
want to perform clustering on. For <span class="math inline">\(\mu \in
\mathbb{R}^{n \times q}\)</span> with unknown rows <span class="math inline">\(\mu_i \in \mathbb{R}^q\)</span> and known,
positive-definite <span class="math inline">\(\Sigma \in \mathbb{R}^{q
\times q}\)</span>, we assume that <span class="math inline">\(x\)</span> is a realization of a random matrix
<span class="math inline">\(X\)</span>, where rows of <span class="math inline">\(X\)</span> are independent and drawn from a
multivariate normal distribution: <span class="math display">\[\begin{equation}
X_i \sim N_q(\mu_i, \Sigma), \quad i = 1, 2, \ldots, n.
\end{equation}\]</span></p>
</div>
<div class="section level3">
<h3 id="inference-for-the-difference-in-means-of-a-single-feature-between-two-estimated-clusters">Inference for the difference in means of a single feature between
two estimated clusters<a class="anchor" aria-label="anchor" href="#inference-for-the-difference-in-means-of-a-single-feature-between-two-estimated-clusters"></a>
</h3>
<p>Let <span class="math inline">\({C}(\cdot)\)</span> be a clustering
algorithm that takes in a data matrix <span class="math inline">\(x\)</span> with <span class="math inline">\(n\)</span> rows and outputs a partition of <span class="math inline">\(\{1,2, \ldots, n\}\)</span> (e.g., hierarchical or
<span class="math inline">\(k\)</span>-means clustering). Suppose that
we now want to use <span class="math inline">\(x\)</span> to test the
null hypothesis that there is no difference in the mean of the <span class="math inline">\(j\)</span>th feature across two groups obtained by
applying <span class="math inline">\({C}(\cdot)\)</span> to <span class="math inline">\(x\)</span>, i.e., <span class="math display">\[\begin{equation}
\hat{H}_{0j}: \bar{\mu}_{\hat{G} j } =  \bar{\mu}_{\hat{G}' j }
\text{ versus } \hat{H}_{1j}: \bar{\mu}_{\hat{G} j }
=  \bar{\mu}_{\hat{G}' j }.
\end{equation}\]</span> Here, <span class="math inline">\(\hat G, \hat
G' \in {C}(x)\)</span> are a pair of estimated clusters. This is
equivalent to testing <span class="math inline">\(\hat{H}_{0j}: [\mu^T
\hat \nu]_j = 0\)</span> versus <span class="math inline">\(\hat{H}_{1j}: [\mu^T \hat{\nu}]_j \neq 0\)</span>,
where <span class="math inline">\(\hat{\nu\)</span>} is the <span class="math inline">\(n\)</span>-vector with <span class="math inline">\(i\)</span>th element given by <span class="math display">\[\begin{equation}
[\hat{\nu}]_i = {1} \{i \in \hat{G}\}/|\hat{G}| - {1} \{i \in
\hat{G}'\}/|\hat{G}'|.
\end{equation}\]</span></p>
<p>This results in a challenging problem because we need to account for
the clustering process that led us to test this hypothesis! Drawing from
the selective inference literature, we tackle this problem by proposing
the following <span class="math inline">\(p\)</span>-value: <span class="math display">\[\begin{align}
\label{eq:selective}
p_{j, \text{selective}}  = \mathbb{P}_{\hat{H}_{0j}} \Big (  \big |[X^T
\hat{\nu}]_j \big | \geq \big |[x^T \hat{\nu}]_j  \big | ~ \Big |~
{C}(X) = {C}(x), U(X) = U(x) \Big ),
\end{align}\]</span> where <span class="math display">\[\begin{align}
U(x) = x - \frac{\hat{\nu} \Sigma_{j}^T [x^T \hat{\nu}]_j
}{\|\hat{\nu}\|_2^2 \Sigma_{jj}}. \label{eq:defU}
\end{align}\]</span> In the definition of <span class="math inline">\(p_{j, \text{selective}}\)</span>, we have
conditioned on (i) the estimated clusters <span class="math inline">\({C}(x)\)</span> to account for the data-driven
nature of the null hypothesis; and (ii) <span class="math inline">\(U(x)\)</span> to eliminate the unknown nuisance
parameters under the null.</p>
<p>We show that this <span class="math inline">\(p\)</span>-value for
testing <span class="math inline">\(\hat{H}_{0j}\)</span> can be written
as {<span class="math display">\[\begin{align}
\begin{split}
\label{eq:selective_cdf}
p_{j, \text{selective}} = 1 - \mathbb{F} \left (\big | [\hat{\nu}^T x]_j
\big | ; 0, \Sigma_{jj}\|\hat{\nu}\|_2^2; {\hat{S}}_j \right ) +
\mathbb{F}\left (-\big | [\hat{\nu}^T x]_j \big | ; 0, \Sigma_{jj}
\|\hat \nu\|_2^2;  {\hat{S}}_j \right ),
\end{split}
\end{align}\]</span>} where <span class="math inline">\(\mathbb{F}(t;
\mu, \sigma, {S})\)</span> denotes the cumulative distribution function
(CDF) of a <span class="math inline">\(N(\mu, \sigma^2)\)</span> random
variable truncated to the set <span class="math inline">\({S}\)</span>,
<span class="math inline">\(x'(\phi,j) = x + (\phi - (
\bar{x}_{\hat{G}j} - \bar{x}_{\hat{G'}j})) \left ( \frac{ \hat{\nu}
}{ \|\hat{\nu}\|_2^2 } \right ) \left ( \frac{\Sigma_j}{\Sigma_{jj}}
\right )^T,\)</span> and <span class="math display">\[\begin{equation}
\hat S_j =
\left \{ \phi \in \mathbb{R}: C(x) = {C}\left(x'(\phi,j)\right )
\right \}. \label{eq:defS}
\end{equation}\]</span>.</p>
<p>While the notation in the last paragraph might seem daunting, the
intuition is simple: since <span class="math inline">\(p_{j,
\text{selective}}\)</span> can be rewritten into sums of CDFs of
truncated univariate normal random variable evaluated at some given
values, it suffices to characterize the truncation set <span class="math inline">\(\hat S_j\)</span>.</p>
<p>We demonstrate how to compute <span class="math inline">\(\hat
S_j\)</span> for hierarchical clustering (and a close variant of it for
<span class="math inline">\(k\)</span>-means clustering) in our
manuscript, and our software implements an efficient calculation of this
<span class="math inline">\(p\)</span>-value by analytically
characterizing the relevant sets. Our key insight is that the set <span class="math inline">\(\hat S_j\)</span> can be expressed as the
intersection of solutions to a series of quadratic inequalities of <span class="math inline">\(\phi\)</span>, leading to efficient and analytical
characterization of the set, and consequently, the <span class="math inline">\(p\)</span>-value. The test based on the resulting
<span class="math inline">\(p\)</span>-value will control the selective
Type I error rate, in the sense of Lee et al. (2016) and Fithian et
al. (2014); see also Figure 1(c) of this tutorial. Additional details
can be found in Sections 3 and 4 of Chen and Gao (2023+).</p>
<p>Remark: by contrast, the naive <span class="math inline">\(p\)</span>-value (used in a two-sample z-test)
takes the form <span class="math display">\[\begin{equation}
p_{j, \text{naive}} = \mathbb{P}_{\hat{H}_{0j}} \left ( | [X^T
\hat{\nu}^T]_j | \geq | [x^T \hat{\nu}]_j| \right ),
\label{eq:naive}
\end{equation}\]</span> which ignores the fact that the contrast vector
<span class="math inline">\(\nu\)</span> is estimated from the data via
clustering, and therefore leads to a test with an inflated Type I error
rate.</p>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<p>Chen YT and Gao LL. (2023+) Testing for a difference in means of a
single feature after clustering. arXiv preprint.</p>
<p>Fithian W, Sun D, Taylor J. (2014) Optimal Inference After Model
Selection. arXiv:1410.2597 [mathST].</p>
<p>Lee J, Sun D, Sun Y, Taylor J. Exact post-selection inference, with
application to the lasso. Ann Stat. 2016;44(3):907-927. <a href="doi:10.1214/15-AOS1371" class="uri">doi:10.1214/15-AOS1371</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Yiqun T. Chen.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
